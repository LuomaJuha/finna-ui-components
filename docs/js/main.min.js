var finna={init:function(){$.each(["mdEditable"],function(t,e){void 0!==finna[e]&&finna[e].init()})}};function FinnaMdEditable(t){this.element=t,this.container=this.element.find(".finna-editable-container"),this.preview=!0===this.container.data("preview"),this.emptyHtml=this.container.data("empty-html"),this.editor=null,this.element.on("click.finnaEditable",{editable:this},function(t){t.stopPropagation(),"A"!==t.target.nodeName&&t.data.editable.openEditable()}),this.element.addClass("inited")}$(document).ready(function(){finna.init()}),$(document).ready(function(){VuFind.truncate.initTruncate(".finna-truncate")}),FinnaMdEditable.prototype.eventOpenEditable="finna:openEditable",FinnaMdEditable.prototype.eventEditableClosed="finna:editableClosed",FinnaMdEditable.prototype.busyClass="finna-editable-busy",FinnaMdEditable.prototype.openClass="finna-editable-open",FinnaMdEditable.prototype.isOpen=function(){return this.element.hasClass(this.openClass)},FinnaMdEditable.prototype.isBusy=function(){return this.element.hasClass(this.busyClass)},FinnaMdEditable.prototype.setBusy=function(t){return this.isOpen()||(this.isBusy()?t||this.element.removeClass(this.busyClass):t&&this.element.addClass(this.busyClass)),this},FinnaMdEditable.prototype.openEditable=function(){if(this.isOpen()||this.isBusy())return this;var t=$.Event(this.eventOpenEditable,{editable:this});if($(document).trigger(t),t.isDefaultPrevented())return this;this.element.addClass(this.openClass),this.container.hide();var e=$("<textarea/>"),n=this.container.data("markdown");e.text(n),e.insertAfter(this.container);var i,a=this,t=[{name:"bold",action:EasyMDE.toggleBold,className:"fa fa-bold",title:VuFind.translate("editor_format_bold")},{name:"italic",action:EasyMDE.toggleItalic,className:"fa fa-italic",title:VuFind.translate("editor_format_italic")},{name:"heading",action:EasyMDE.toggleHeadingSmaller,className:"fa fa-header fa-heading",title:VuFind.translate("editor_format_heading")},"|",{name:"quote",action:EasyMDE.toggleBlockquote,className:"fa fa-quote-left",title:VuFind.translate("editor_format_quote")},{name:"unordered-list",action:EasyMDE.toggleUnorderedList,className:"fa fa-list-ul",title:VuFind.translate("editor_format_unordered_list")},{name:"ordered-list",action:EasyMDE.toggleOrderedList,className:"fa fa-list-ol",title:VuFind.translate("editor_format_ordered_list")},"|",{name:"link",action:EasyMDE.drawLink,className:"fa fa-link",title:VuFind.translate("editor_create_link")},{name:"image",action:EasyMDE.drawImage,className:"fa fa-image",title:VuFind.translate("editor_insert_image")},"|",{name:"other",className:"fa fa-plus-small",title:VuFind.translate("editor_other_commands"),children:[{name:"panel",action:function(){a._insertPanel()},className:"fa details-icon",title:VuFind.translate("editor_insert_panel")},{name:"truncate",action:function(){a._insertTruncate()},className:"fa fa-pagebreak",title:VuFind.translate("editor_insert_truncate")}]},{name:"close",action:function(){a.closeEditable()},className:"fa fa-times editor-toolbar-close",title:VuFind.translate("editor_close_editor")}],n={link:VuFind.translate("editor_prompt_link"),image:VuFind.translate("editor_prompt_image")},t={autoDownloadFontAwesome:!1,autofocus:!0,element:e[0],indentWithTabs:!1,promptTexts:n,promptURLs:!0,toolbar:t,spellChecker:!1,status:!1};return this.editor=new EasyMDE(t),this.element.find(".CodeMirror-code").focus(),this.element.find(".EasyMDEContainer").unbind("click").click(function(){return!1}),this.preview&&(t=this.editor.options.previewRender(this.editor.value()),$(".markdown-preview").remove(),i=$("<div/>").addClass("markdown-preview").html($("<div/>").addClass("data").html(t)),$("<div/>").addClass("preview").text(VuFind.translate("preview").toUpperCase()).prependTo(i),i.appendTo(this.element),this.editor.codemirror.on("change",function(){var t=a.editor.options.previewRender(a.editor.value());i.find(".data").html(t)})),this},FinnaMdEditable.prototype.closeEditable=function(){var t;null!==this.editor&&(t=this.editor.value(),e=this.editor.options.previewRender(t),this.editor.toTextArea(),this.editor=null,this.element.removeClass(this.openClass).find("textarea").remove(),this.container.show(),this.container.data("markdown",t),0===t.length&&(e=this.emptyHtml),this.container.html(e),this.preview&&this.element.find(".markdown-preview").remove());var e=$.Event(this.eventEditableClosed,{editable:this});return $(document).trigger(e),this},FinnaMdEditable.prototype._insertElement=function(t,e,n){var i=this.editor.codemirror.getDoc();i.replaceRange(t,i.getCursor()),this.editor.codemirror.focus();t=i.getCursor();t.line=t.line+e,t.ch=n,i.setCursor(t)},FinnaMdEditable.prototype._insertPanel=function(){var t=VuFind.translate("details_summary_placeholder"),e='\n<finna-panel>\n  <span slot="heading">'+t+"</span>\n\n  "+VuFind.translate("details_text_placeholder")+"\n</finna-panel>\n";this._insertElement(e,-4,23+t.length)},FinnaMdEditable.prototype._insertTruncate=function(){var t=VuFind.translate("details_summary_placeholder"),e='\n<finna-truncate>\n  <span slot="label">'+t+"</span>\n\n  "+VuFind.translate("details_text_placeholder")+"\n</finna-truncate>\n";this._insertElement(e,-4,21+t.length)},finna.mdEditable=function(){var t=[];return{editables:t,init:function(){$(".finna-md-editable:not(.inited)").each(function(){t.push(new FinnaMdEditable($(this)))})}}}(),$(document).ready(function(){$(".finna-tabs-nav").each(function(){var t=$(this).find(".finna-nav > li.active > ul, .finna-nav > li.active-trail > ul");0<t.length&&0<$(this).height()&&$(this).css("height",$(this).children(".finna-nav").height()+t.height())})}),finna.layout=function(n){function t(){var t=n||$(document),e=[];t.find('[data-toggle="tooltip"]').on("show.bs.tooltip",function(){var t=$(this);$(e).each(function(){$(this)[0]!==t[0]&&$(this).tooltip("hide")}),e=[t]}).on("hidden.bs.tooltip",function(t){$(t.target).data("bs.tooltip").inState.click=!1}).tooltip({trigger:"click",viewport:".pl-js-pattern-example"}),t.find('[data-toggle="tooltip"] > i').on("click",function(t){t.preventDefault()}),$("html").on("click",function(t){void 0===$(t.target).parent().data("original-title")&&void 0===$(t.target).data("original-title")&&($('[data-toggle="tooltip"]').tooltip("hide"),e=[])})}return{isTouchDevice:function(){return"ontouchstart"in window||0<navigator.maxTouchPoints||0<navigator.msMaxTouchPoints},initToolTips:t,init:function(){t()}}}(),$(document).ready(function(){finna.layout.init()}),VuFind.register("truncate",function(){const F={"btn-class":"","in-place-toggle":!1,label:null,"less-label":VuFind.translate("show_less"),"more-label":VuFind.translate("show_more"),rows:3,"top-toggle":1/0,"wrapper-class":"","wrapper-tagname":null};return{initTruncate:function(t,_,w){var y=[];$(t).not(".truncate-done").each(function(){var t=$(this),e=Object.assign({},F,t.data("truncate")),n=void 0!==_?t.find(_):void 0!==e.element&&t.find(e.element),i=void 0===w?function(t){return t}:w,a=parseFloat(e.rows),s=c=e.label;null===c&&(s=e["more-label"],c=e["less-label"]);var o,l,r,d,c,h,u,p,f=e["btn-class"]?" "+e["btn-class"]:"",m=e["top-toggle"],g=!(!n||!e["in-place-toggle"])&&e["in-place-toggle"],b=e["wrapper-class"],v=e["wrapper-tagname"],E=[];n?(p=n.parent(),o=t.find(n).length||0,l=a<o,""===b&&(b=n.length?n.prop("class"):""),v=v||n.length&&n.prop("tagName").toLowerCase(),l&&n.each(function(t){t===a&&$(this).addClass("truncate-start"),a<=t&&($(this).hide(),E.push(this))})):(d=0<(p=t).children().length?(e=(d=t.children().first()).css("display"),!d.is("div")&&!d.is("span")||"block"!==e&&"inline-block"!==e?parseFloat(d.css("line-height").replace("px","")):parseFloat(d.outerHeight())):parseFloat(t.css("line-height").replace("px","")),o=t.height()/d,(l=0===a||0!==a&&a+1.5<o)&&(r=a*d,t.css("height",r+"px"))),l&&(s='<button type="button" class="btn more-btn'+f+'">'+s+' <i class="fa fa-arrow-down" aria-hidden="true"></i></button>',c='<button type="button" class="btn less-btn'+f+'">'+c+' <i class="fa fa-arrow-up" aria-hidden="true"></i></button>',b=b?" "+b:"",v=v||"div",v=$("<"+v+' class="more-less-btn-wrapper'+b+'"></'+v+">"),h=v.clone().append(i(s+c)),(u=m<o&&v.clone().append(i(c)))&&(n?u.prependTo(p):u.insertBefore(p)),g?h.insertBefore(p.find(".truncate-start")):n?h.appendTo(p):h.insertAfter(p),h.find(".less-btn").hide(),u&&u.hide(),p=function(){h.find(".less-btn").hide(),u&&u.hide(),h.find(".more-btn").show(),n?E.forEach(function(t){$(t).toggle()}):0===r?t.hide():t.css("height",r+"px"),h.find(".more-btn").focus()},h.find(".less-btn").click(p),u&&u.find(".less-btn").click(p),h.find(".more-btn").click(function(){$(this).hide(),h.find(".less-btn").show(),u?(u.show(),u.find(".less-btn").focus()):h.find(".less-btn").focus(),n?E.forEach(function(t){$(t).toggle()}):0===r?t.show():t.css("height","auto")})),t.addClass("truncate-done"),0===r&&y.push(t)}),y.forEach(function(t){t.hide(),t.css("height","auto")})}}});